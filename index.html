<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>1D Phase Game</title>

<style>
body{
  margin:0;
  background:black;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
}

canvas{
  background:black;
}

#restart{
  position:absolute;
  top:20px;
  left:20px;
  padding:10px 18px;
  background:#111;
  color:white;
  border:1px solid #333;
  cursor:pointer;
  display:none;
}
</style>
</head>
<body>

<button id="restart">Rena√Ætre</button>
<canvas id="game" width="900" height="300"></canvas>

<script>
const canvas = document.getElementById("game")
const ctx = canvas.getContext("2d")
const restartBtn = document.getElementById("restart")

const lineY = 150

const player = {
  x:120,
  size:30,
  phasing:false,
  phaseTimer:0
}

const PHASE_TIME = 18
let speed = 7
let obstacles = []
let gameOver = false

function spawnObstacle(){
  obstacles.push({
    x: canvas.width,
    y: lineY - 15,
    w: 25,
    h: 30
  })
}

setInterval(spawnObstacle, 1000)

document.addEventListener("keydown", e=>{
  if(e.code === "Space" && !player.phasing && !gameOver){
    player.phasing = true
    player.phaseTimer = PHASE_TIME
  }
})

restartBtn.onclick = () => reset()

function reset(){
  obstacles = []
  gameOver = false
  player.phasing = false
  restartBtn.style.display = "none"
}

function collide(a,b){
  return a.x < b.x+b.w &&
         a.x+a.size > b.x &&
         lineY-15 < b.y+b.h &&
         lineY-15+a.size > b.y
}

function update(){

  if(gameOver) return

  if(player.phasing){
    player.phaseTimer--
    if(player.phaseTimer <= 0){
      player.phasing = false
    }
  }

  obstacles.forEach(o => o.x -= speed)
  obstacles = obstacles.filter(o => o.x > -40)

  for(let o of obstacles){
    if(!player.phasing && collide(player,o)){
      gameOver = true
      restartBtn.style.display = "block"
    }
  }
}

function draw(){

  ctx.clearRect(0,0,canvas.width,canvas.height)

  ctx.fillStyle="#111"
  ctx.fillRect(0,lineY,canvas.width,3)

  ctx.fillStyle = player.phasing ? "#5a0000" : "red"
  ctx.fillRect(player.x, lineY-15, player.size, player.size)

  ctx.fillStyle="white"
  obstacles.forEach(o=>{
    ctx.fillRect(o.x, o.y, o.w, o.h)
  })

  if(gameOver){
    ctx.fillStyle="white"
    ctx.font="40px Arial"
    ctx.fillText("GAME OVER", 320, 110)
  }
}

function loop(){
  update()
  draw()
  requestAnimationFrame(loop)
}

loop()
</script>

</body>
</html>


loop()
</script>

</body>
</html>
